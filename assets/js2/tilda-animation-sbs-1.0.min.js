function t_animateSbs__wrapAtomEls(){$("[data-animate-sbs-event]").each(function(){$(this);$(this).find(".tn-atom").wrap("<div class='tn-atom__sbs-anim-wrapper' style='display:table; width:inherit; height:inherit;'></div>")})}function t_animateSbs__init(){var e={els:$("[data-animate-sbs-event]"),scrollTop:window.pageYOffset,stop:!1,needUpdate:!0};if(e.mode=void 0!==$(e.els[0]).attr("data-field-sbsevent-value")?"edit":"publish",0!=e.els.length){t_animateSbs__cashElsInfo(e);var t,a=t_animateSbs__generateKeyframes(e);if(""!=a&&$("head").append('<style class="sbs-anim-keyframes">'+a+"</style>"),"y"==window.lazy&&t_lazyload_update(),$(window).resize(function(){clearTimeout(t),t=setTimeout(function(){$(window).width()<1200?(e.stop=!0,t_animateSbs__reset(e)):(e.stop=!1,t_animateSbs__cashElsInfo(e),t_animateSbs__triggerTimeAnim(e),t_animateSbs__triggerScrollAnim(e))},500)}),$(window).width()>=1200)t_animateSbs__triggerTimeAnim(e),$("[data-animate-sbs-event=scroll]").length>0&&(t_animateSbs__triggerScrollAnim(e),t_animateSbs__checkFrame(e));$(window).load(function(){t_animateSbs__rereadElsValues(e)}),setTimeout(function(){t_animateSbs__rereadElsValues(e)},3e3)}}function t_animateSbs__rereadElsValues(e){for(var t=0;t<e.els.length;t++){var a=e.els[t];t_animateSbs__cashElsTopOffset(a,e),"scroll"==a.changeType&&t_animateSbs__updateStepsStartValues(a)}}function t_animateSbs__checkFrame(e){e.needUpdate=t_animateSbs__checkChanges(e),e.needUpdate&&!1===e.stop&&t_animateSbs__triggerScrollAnim(e),requestAnimationFrame(function(){t_animateSbs__checkFrame(e)})}function t_animateSbs__checkChanges(e){var t=e.scrollTop;return e.scrollTop=window.pageYOffset,t!=e.scrollTop&&0==e.stop}function t_animateSbs__triggerScrollAnim(e){for(var t=e.els,a=0;a<t.length;a++){var s=t[a];if("time"!==s.changeType){var i={opacity:1,blur:0,fix:!1,fix__shiftY:0,translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0};t_animateSbs__triggerScrollAnim__checkElSteps(e,s,i),t_animateSbs__triggerScrollAnim__changeEl(s,i,e)}}}function t_animateSbs__triggerScrollAnim__checkElSteps(e,t,a){for(var s=0;s<t.steps.length;s++){var i=t.steps[s];i.index=s;var r=e.scrollTop+t.triggerOffset,n=r>=i.start,o=r<i.start,l=i.end<=r,_=i.end>r;if(n&&_){i.state="started",t.wrapperEl.css("will-change","transform");var m=r-i.start,c=0==i.dist?1:m/i.dist;a.prevUnfixedDist=i.prevUnfixedDist,t_animateSbs__triggerScrollAnim__calcStyle(t,a,i,c)}l&&(i.state="finished",t.wrapperEl.css("will-change",""),t_animateSbs__triggerScrollAnim__calcStyle(t,a,i,1)),!o||"started"!=i.state&&"finished"!=i.state||(i.state="unactive",t.wrapperEl.css("will-change",""),t_animateSbs__triggerScrollAnim__calcStyle(t,a,i,0))}t.steps[1]&&"unactive"===t.steps[1].state&&0===t.steps[1].styles.opacity&&0===t.steps[1].dist&&(a.opacity=0)}function t_animateSbs__generateKeyframes(e){for(var t="",a=0;a<e.els.length;a++){var s=e.els[a];if("time"===s.changeType){var i={timeDuration:0},r=[];if(t_animateSbs__generateKeyframes__combineObjects(s.steps,r,i),t_animateSbs__generateKeyframes__correctFrames(r),t_animateSbs__generateKeyframes__countPercent(r,i),t_animateSbs__generateKeyframes__correctOpacityOnFirstStep(s,r),keyframes_str=t_animateSbs__generateKeyframes__getTxtStyles(r),i.timeDuration/=1e3,"hover"===s.animType&&"yes"!==s.loop&&"publish"===e.mode)i.hover=!0,t+=t_animateSbs__generateKeyframes__getFinalCss(s,i,keyframes_str),i.hover=!1,i.reverse=!0,t+=t_animateSbs__generateKeyframes__getFinalCss(s,i,t_animateSbs__generateKeyframes__getTxtStyles(t_animateSbs__generateKeyframes__reverseObj(r)));else t+=t_animateSbs__generateKeyframes__getFinalCss(s,i,keyframes_str)}}return t}function t_animateSbs__generateKeyframes__getFinalCss(e,t,a,s){var i="",r=$(e).attr("data-elem-id"),n="sbs-anim-"+r,o=$(e).parents(".t-rec").attr("id");if(e.timeDuration=t.timeDuration,void 0!==o&&(i+="#"+o+" ",n="sbs-anim-"+o+"-"+r,!0===t.reverse&&(n+="_reverse")),!0===t.hover)var l='[data-elem-id="'+r+'"].t-sbs-anim_started:hover .tn-atom__sbs-anim-wrapper';else l='[data-elem-id="'+r+'"].t-sbs-anim_started .tn-atom__sbs-anim-wrapper';return i+=l+" {\nanimation: "+n+" "+t.timeDuration+"s","yes"===e.loop&&(i+=" infinite"),i+=" linear","yes"!==e.loop&&(i+=" forwards"),i+=";\nbackface-visibility: hidden;\n}\n\n@keyframes "+n+" {\n"+a+"}\n\n"}function t_animateSbs__generateKeyframes__combineObjects(e,t,a){for(var s=0;s<e.length;s++){var i=e[s],r={};r.styles=i.styles,r.time=1*i.time,s!==e.length-1&&(r.ease=e[s+1].ease),t.push(r),a.timeDuration+=r.time}}function t_animateSbs__generateKeyframes__correctFrames(e){for(var t=0;t<e.length;t++){var a=e[t],s=t===e.length-1,i=0===t;if(!s)var r=e[t+1];if(!i)var n=e[t-1];for(var o in a.styles)i||o in n.styles||t_animateSbs__generateKeyframes__addStyleToKeyframe(a,n,o,0),s||(o in r.styles?"moveX"!==o&&"moveY"!==o&&"rotate"!==o||t_animateSbs__generateKeyframes__recalculateValue(a,r,o):t_animateSbs__generateKeyframes__addStyleToKeyframe(a,r,o,"1"))}}function t_animateSbs__generateKeyframes__addStyleToKeyframe(e,t,a,s){"blur"!==a&&"rotate"!==a&&"moveX"!==a&&"moveY"!==a||(t.styles[a]=0===s?0:e.styles[a]),"opacity"!==a&&"scaleX"!==a&&"scaleY"!==a||(t.styles[a]=0===s?1:e.styles[a])}function t_animateSbs__generateKeyframes__recalculateValue(e,t,a){"rotate"===a&&(t.styles.rotate=1*e.styles.rotate+1*t.styles.rotate),"moveX"===a&&(t.styles.moveX=1*e.styles.moveX+1*t.styles.moveX),"moveY"===a&&(t.styles.moveY=1*e.styles.moveY+1*t.styles.moveY)}function t_animateSbs__generateKeyframes__countPercent(e,t){for(var a=0;a<e.length;a++){var s=e[a];if(0===a)s.percent=Math.round(s.time/t.timeDuration*100);else if(a===e.length-1)s.percent=100;else{var i=e[a-1].percent;s.percent=Math.round(s.time/t.timeDuration*100+i),s.percent==i&&(s.percent+=1),s.percent>100&&(s.percent=99)}}}function t_animateSbs__generateKeyframes__correctOpacityOnFirstStep(e,t){var a=t[1];void 0!==a&&0===a.time&&0===a.styles.opacity&&$(window).width()>=1200&&($(e).find(".tn-atom__sbs-anim-wrapper").css("opacity",0),t[0].styles.opacity=0)}function t_animateSbs__generateKeyframes__getTxtStyles(e){for(var t="",a=0;a<e.length;a++)void 0===e[a].changes&&(e[a].changes=t_animateSbs__generateKeyframes__getFrameChanges(e[a])),t+=e[a].percent+"% {"+e[a].changes+"}\n";return t}function t_animateSbs__generateKeyframes__getFrameChanges(e){var t="",a="",s={x:1,y:1,changed:!1};for(var i in e.styles)"opacity"===i&&(t+="opacity:"+e.styles.opacity+";"),"scaleX"===i&&(s.x=e.styles.scaleX,s.changed=!0),"scaleY"===i&&(s.y=e.styles.scaleY,s.changed=!0),"moveX"===i&&(a+="translateX("+e.styles.moveX+"px)"),"moveY"===i&&(a+="translateY("+e.styles.moveY+"px)"),"rotate"==i&&(a+="rotate("+e.styles.rotate+"deg)");if(!0===s.changed&&(a+="scale("+s.x+","+s.y+")"),""!=a&&(t+="transform:"+a+";"),void 0!==e.ease)switch(t+="animation-timing-function:",e.ease){case"easeIn":t+="ease-in;";break;case"easeOut":t+="ease-out;";break;case"easeInOut":t+="ease-in-out;";break;case"bounceFin":t+="cubic-bezier(0.34,1.61,0.7,1);";break;default:t+="linear;"}return t}function t_animateSbs__generateKeyframes__reverseObj(e){for(var t=[],a=e.length-1;a>=0;a--){var s={percent:100-e[a].percent,changes:e[a].changes};t.push(s)}return t}function t_animateSbs__triggerScrollAnim__changeEl(e,t,a){if(!0===t.fix&&"fixed"!=e.wrapperEl.css("position")){var s=e.triggerOffset-t.prevUnfixedDist;e.wrapperEl.css({top:s+"px",position:"fixed"})}!1===t.fix&&"fixed"==e.wrapperEl.css("position")&&e.wrapperEl.css({position:"",top:""}),null!==t.opacity&&e.wrapperEl.css("opacity",t.opacity);var i="";t.translateX&&(i+="translateX("+t.translateX+"px)"),0===t.translateY&&0===t.fix__shiftY||(i+="translateY("+(t.translateY+t.fix__shiftY)+"px)"),1===t.scaleX&&1===t.scaleY||(i+="scale("+t.scaleX+","+t.scaleY+")"),0!==t.rotate&&(i+="rotate("+t.rotate+"deg)"),e.wrapperEl.css("transform",i),""!==i?e.wrapperEl.css("transform",i):e.wrapperEl.css("transform","scale(1)")}function t_animateSbs__triggerScrollAnim__calcStyle(e,t,a,s){if(!0===a.styles.fix&&"started"==a.state&&(t.fix=!0,t.fix__shiftY=0),!0===a.styles.fix&&"finished"==a.state&&(t.fix=!1,t.fix__shiftY+=1*a.dist),!0===a.styles.fix&&"unactive"==a.state){if(a.index>0&&!0===t.fix)return;t.fix=!1}t.opacity+=s*(a.styles.opacity-t.opacity),t.blur+=s*(a.styles.blur-t.blur),t.translateX+=s*a.styles.moveX,t.translateY+=s*a.styles.moveY,t.scaleX+=s*(a.styles.scaleX-t.scaleX),t.scaleY+=s*(a.styles.scaleY-t.scaleY),t.rotate+=s*a.styles.rotate}function t_animateSbs__cashElsInfo(e){for(var t=e.els,a=0;a<t.length;a++){var s=t[a];s.state="unactive",s.animType="edit"===e.mode?$(s).attr("data-field-sbsevent-value"):$(s).attr("data-animate-sbs-event"),s.changeType="scroll"===s.animType?"scroll":"time",s.trigger="edit"===e.mode?$(s).attr("data-field-sbstrg-value"):$(s).attr("data-animate-sbs-trg"),s.trigger=void 0===s.trigger?1:s.trigger,s.wrapperEl=$(s).find(".tn-atom__sbs-anim-wrapper"),s.steps=[];var i="edit"===e.mode?$(s).attr("data-field-sbsopts-value"):$(s).attr("data-animate-sbs-opts");if(void 0!==i){i=i.replace(/'/g,'"');var r=JSON.parse(i);t_animateSbs__addDelayStepsToStepsArr(r),s.loop="edit"===e.mode?$(s).attr("data-field-sbsloop-value"):$(s).attr("data-animate-sbs-loop"),s.loop="loop"===s.loop?"yes":"none",t_animateSbs__cashElsTopOffset(s,e);for(var n=0,o=0;o<r.length;o++){var l={state:"unactive"};l.styles=t_animateSbs__getStylesObj(r[o]),"scroll"==s.changeType?(l.prevUnfixedDist=n,l.dist=r[o].di,!1===l.styles.fix&&(n+=Number(l.dist)),l.start=0==o?s.topOffset:s.steps[o-1].end,l.end=l.start+1*l.dist):(l.time=r[o].ti,l.ease=r[o].ea),s.steps.push(l)}t_animateSbs__updateInfoOnImgLoad(s,e),t_animateSbs__recalcStepsStylesDiff(s.steps)}}}function t_animateSbs__updateInfoOnImgLoad(e,t){$(e).find("img").on("load",function(){t_animateSbs__cashElsTopOffset(e,t),"scroll"==e.changeType&&t_animateSbs__updateStepsStartValues(e)}).each(function(){this.complete&&$(this).load()})}function t_animateSbs__updateStepsStartValues(e){for(var t=0;t<e.steps.length;t++){var a=e.steps[t];a.start=0==t?e.topOffset:e.steps[t-1].end,a.end=a.start+1*a.dist}}function t_animateSbs__cashElsTopOffset(e,t){if(("scroll"==e.animType||"intoview"==e.animType||"blockintoview"==e.animType)&&"publish"===t.mode){var a=1*$(e).css("top").replace("px",""),s=$(e).parents(".r"),i=s.offset().top+1*s.css("padding-top").replace("px","");e.blockTopOffset=i,e.topOffset=i+a,t_animateSbs__getElTrigger(e)}}function t_animateSbs__addDelayStepsToStepsArr(e){for(var t=0;t<e.length;t++){var a=e[t];if(void 0!==a.dd&&""!==a.dd&&0!=a.dd||void 0!==a.dt&&""!==a.dt&&0!=a.dt){var s=0!==t?t_animateSbs__cloneStep(e[t-1]):{mx:"0",my:"0",sx:"1",sy:"1",op:"1",ro:"0",bl:"0",ea:""};void 0!==a.dt?s.ti=a.dt:s.di=a.dd,e.splice(t,0,s),t++}}}function t_animateSbs__cloneStep(e){return{mx:e.mx,my:e.my,sx:e.sx,sy:e.sy,op:e.op,ro:e.ro,bl:e.bl,ea:e.ea}}function t_animateSbs__recalcStepsStylesDiff(e){for(var t=e[0].styles.moveX,a=e[0].styles.moveY,s=e[0].styles.rotate,i=1;i<e.length;i++){var r=e[i].styles;e[i-1].styles;r.moveX=r.moveX-t,t+=r.moveX,r.moveY=r.moveY-a,a+=r.moveY,r.rotate=r.rotate-s,s+=r.rotate}}function t_animateSbs__getStylesObj(e){var t={};return t.moveX=void 0!==e.mx?1*e.mx:0,t.moveY=void 0!==e.my?1*e.my:0,t.scaleX=void 0!==e.sx?1*e.sx:1,t.scaleY=void 0!==e.sy?1*e.sy:1,t.opacity=void 0!==e.op?1*e.op:1,t.rotate=void 0!==e.ro?1*e.ro:0,t.blur=void 0!==e.bl?1*e.bl:0,t.fix=void 0!==e.fi&&"fixed"===e.fi,t}function t_animateSbs__getElTrigger(e){var t=$(window).height();e.triggerOffset=$(e).attr("data-animate-sbs-trgofst"),e.triggerOffset=void 0===e.triggerOffset?0:1*e.triggerOffset,"0.5"==e.trigger&&(e.triggerOffset+=t/2,("intoview"===e.animType||"scroll"===e.animType)&&e.triggerOffset>e.topOffset&&e.triggerOffset<=t/2&&(e.triggerOffset=e.topOffset),"blockintoview"===e.animType&&e.triggerOffset>e.blockTopOffset&&e.triggerOffset<=t/2&&(e.triggerOffset=e.blockTopOffset)),"1"==e.trigger&&(e.triggerOffset+=t,("intoview"===e.animType||"scroll"===e.animType)&&e.triggerOffset>e.topOffset&&e.triggerOffset<=t&&(e.triggerOffset=e.topOffset),"blockintoview"===e.animType&&e.triggerOffset>e.blockTopOffset&&e.triggerOffset<=t&&(e.triggerOffset=e.blockTopOffset))}function t_animateSbs__triggerTimeAnim(e){var t=e.els.filter('[data-animate-sbs-event="hover"]');t.on("mouseover",function(e){$(this).addClass("t-sbs-anim_started")}),t.on("mouseout",function(){$(this).on("animationiteration",function e(){$(this).removeClass("t-sbs-anim_started"),$(this).off("animationiteration",e)})}),e.els.filter('[data-animate-sbs-event="click"]').on("click",function(){$(this).addClass("t-sbs-anim_started")});var a=e.els.filter('[data-animate-sbs-event="intoview"], [data-animate-sbs-event="blockintoview"]');t_animateSbs__checkIntoviewEls(e,a),$(window).bind("scroll",t_throttle(function(){t_animateSbs__checkIntoviewEls(e,a)},200))}function t_animateSbs__checkIntoviewEls(e,t){if(0!==t.length){e.scrollTop=window.pageYOffset;for(var a=0;a<t.length;a++){var s=t[a],i=e.scrollTop+s.triggerOffset;if("blockintoview"===s.animType)var r=i>=s.blockTopOffset;else r=i>=s.topOffset;r&&!1===$(s).hasClass("t-sbs-anim_started")&&($(s).addClass("t-sbs-anim_started"),t.splice(a,1),a--)}}}function t_animateSbs__reset(e){for(var t=e.els,a=0;a<t.length;a++)if("intoview"===t[a].animType||"blockintoview"===t[a].animType)$(t[a]).removeClass("t-sbs-anim_started"),$(t[a]).find(".tn-atom__sbs-anim-wrapper").css("opacity","");else{t[a].state="reseted";var s=t[a].wrapperEl;$(s).css({transform:"",position:"",top:"",opacity:""})}}function t_animateParallax__checkOldIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE"),a="",s=!1;return t>0&&(8!=(a=parseInt(e.substring(t+5,e.indexOf(".",t))))&&9!=a||(s=!0)),s}$(document).ready(function(){1==window.isSearchBot||t_animateParallax__checkOldIE()||window.isMobile&&$(window).width()<1200||"edit"==$(".t-records").attr("data-tilda-mode")||(t_animateSbs__wrapAtomEls(),setTimeout(function(){t_animateSbs__init()},50))});
